<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Dashboard - Retail Rise</title>
    <link rel="stylesheet" href="/static/stylesheet.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <!--Navigation bar-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <img src="/static/images/retail rise logo.png" alt="Retail Rise Logo" width="70" height="70" class="me-2"> Retail Rise
            </a>
        </div>
    </nav>
    
    <!--Seller Dashboard Section-->
    <div class="container mt-4">
        <h2>Seller Dashboard</h2>

        <div class="card p-4 mb-4">
            <h3>Add New Product</h3>

            <form action="/add_product" method="POST">
                <div class="mb-3">
                    <label for="name" class="form-label">Product Name:</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="mb-3">
                    <label for="description" class="form-label">Description</label>
                    <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="price" class="form-label">Price (Ksh):</label>
                    <input type="number" class="form-control" id="price" name="price" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="image_url" class="form-label">Image URL (e.g, images/product 7.webp):</label>
                    <input type="text" class="form-control" id="image_url" name="image_url" required>
                </div>
                <div class="mb-3">
                    <label for="stock" class="form-label">Stock Quantity:</label>
                    <input type="number" class="form-control" id="stock" name="stock" required>
                <button type="submit" class="btn btn-success">Add Product</button>
            </form>
        </div>

        <h3>Your Products</h3>
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Prices</th>
                    <th>Stock</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- JS will render products here -->
            </tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        //Fetch and render products
        function loadProducts() {
            fetch('/api/seller_products')
                .then(res => res.json())
                .then(products => {
                    const tbody = document.querySelector('table tbody');
                    tbody.innerHTML = ''; // Clear existing rows
                    products.forEach(product => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${product.name}</td>
                                <td>Ksh ${product.price}</td>
                                <td>${product.stock || 0}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm" onclick="editProduct(${product.id})">Edit</button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">Delete</button>
                                </td>
                            </tr>
                        `;
                    });
                });
        }

        //DELETE product function
        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                fetch(`/api/product/${productId}`, { method: 'DELETE' })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) loadProducts(); // Reload products after deletion
                    });
            }
        }

        //EDIT product function
        function editProduct(productId) {
            const name = prompt('Enter new product name:');
            const description = prompt('Enter new product description:');
            const price = prompt('Enter new product price:');
            const image_url = prompt('Enter new product image URL:');
            const stock = prompt('Enter new stock quantity:');

            if (name && price && stock) {
                fetch(`/api/product/${productId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description, price, image_url, stock })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) loadProducts(); // Reload products after editing
                });
            }
        }
        loadProducts(); // Initial load of products
    </script>

    <!--Footer-->
    <footer class="bg-light py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 Retail Rise. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>